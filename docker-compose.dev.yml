# Docker Compose - Development Environment with Hot Reload
# Extends docker-compose.yml with development-specific configurations
version: '3.8'

services:
  # ==================== Core Services (with volume mounts for hot reload) ====================

  tenant-service:
    build:
      context: .
      dockerfile: ./services/tenant-service/Dockerfile
      target: development
    volumes:
      - ./services/tenant-service/src:/app/services/tenant-service/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  auth-service:
    build:
      context: .
      dockerfile: ./services/auth-service/Dockerfile
      target: development
    volumes:
      - ./services/auth-service/src:/app/services/auth-service/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  state-manager:
    build:
      context: .
      dockerfile: ./services/state-manager/Dockerfile
      target: development
    volumes:
      - ./services/state-manager/src:/app/services/state-manager/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  # ==================== WhatsApp Services ====================

  whatsapp-webhook-service:
    build:
      context: .
      dockerfile: ./services/whatsapp-webhook-service/Dockerfile
      target: development
    volumes:
      - ./services/whatsapp-webhook-service/src:/app/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  whatsapp-api-service:
    build:
      context: .
      dockerfile: ./services/whatsapp-api-service/Dockerfile
      target: development
    volumes:
      - ./services/whatsapp-api-service/src:/app/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  # ==================== Genesys Services ====================

  genesys-webhook-service:
    build:
      context: .
      dockerfile: ./services/genesys-webhook-service/Dockerfile
      target: development
    volumes:
      - ./services/genesys-webhook-service/src:/app/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  genesys-api-service:
    build:
      context: .
      dockerfile: ./services/genesys-api-service/Dockerfile
      target: development
    volumes:
      - ./services/genesys-api-service/src:/app/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  # ==================== Transformer Services ====================

  inbound-transformer:
    build:
      context: .
      dockerfile: ./services/inbound-transformer/Dockerfile
      target: development
    volumes:
      - ./services/inbound-transformer/src:/app/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  outbound-transformer:
    build:
      context: .
      dockerfile: ./services/outbound-transformer/Dockerfile
      target: development
    volumes:
      - ./services/outbound-transformer/src:/app/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  # ==================== API Gateway ====================

  api-gateway:
    build:
      context: .
      dockerfile: ./services/api-gateway/Dockerfile
      target: development
    volumes:
      - ./services/api-gateway/src:/app/services/api-gateway/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  # ==================== Frontend Services ====================

  agent-widget:
    build:
      context: .
      dockerfile: ./services/agent-widget/Dockerfile
      target: development
    volumes:
      - ./services/agent-widget/src:/app/src:ro
      - ./services/agent-widget/public:/app/public:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev

  admin-dashboard:
    build:
      context: .
      dockerfile: ./services/admin-dashboard/Dockerfile
      target: development
    volumes:
      - ./services/admin-dashboard/src:/app/src:ro
      - ./services/admin-dashboard/public:/app/public:ro
    ports:
      - "3013:3006"  # Vite dev server port
    environment:
      NODE_ENV: development
    environment:
      NODE_ENV: development
    command: npm run dev -- --host

  agent-portal:
    build:
      context: .
      dockerfile: ./services/agent-portal/Dockerfile
      target: development
    volumes:
      - ./services/agent-portal/src:/app/services/agent-portal/src:ro
      - ./services/agent-portal/public:/app/services/agent-portal/public:ro
    ports:
      - "3014:5173"
    environment:
      NODE_ENV: development
    command: npm run dev -- --host

  # ==================== Webhook Handler ====================

  webhook-handler:
    build:
      context: .
      dockerfile: ./services/webhook-handler/Dockerfile
      target: development
    volumes:
      - ./services/webhook-handler/src:/app/src:ro
      - ./shared:/app/shared:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    command: npm run dev
